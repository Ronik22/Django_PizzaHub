{% extends "ecom/base.html" %}
{% load static %}

{% block title %}
    Pizza-Hub | Cart
{% endblock %}

{% block fbgnav %}
    nav-fbg
{% endblock %}

{% block content %}

        <!-- FIRST PART -->

        <div class="m-jumbo">
            <h2 class="p2-heading"><i class="fas fa-shopping-cart"></i> Cart</h2>
        </div>

        <!-- SECOND PART -->

        <!-- Cart -->

        <div class="shpcart">
            <table id="shptable">
                <tr>
                    <th class="thsplft">Product</th>
                    <th>Price</th> 
                    <th>Quantity</th>
                    <th>Total</th>
                </tr>
                <tbody id="all_products">
                {% for item in products %}
                    <tr>
                        <td class="shpimg">
                            <img src="{% static 'ecom/images/karthik-garikapati-oBbTc1VoT-0-unsplash.jpg' %}" alt="">
                            <div>{{item.product.item}}</div>
                        </td>
                        <td>{{item.product.price}}</td>
                        <td class="quantity">
                            <input id="cartitemno" class="tdinp" type="number" value="{{item.quantity}}" min="0" max="10">
                        </td>
                        <td>{{item.product.price}}</td>
                    </tr>
                {% endfor %}
                </tbody>
                
                <tr>
                    <td class="thsplft">
                        
                    </td>
                    <td></td>
                    <td id="total_quantity">5454</td>
                    <td id="total_display">$5454</td>
                </tr>
            </table>
        </div>

        <div class="shpcheckout">
            <h3>Order Summary:</h3>
            <hr style="margin: 20px 0px 30px 0px;">
            <span>&nbsp&#9745 Item Subtotal: $249.99</span>
            <span>&nbsp&#9745 Discount: $49</span>
            <span>&nbsp&#9745 Delivery Charges: FREE</span> 
            <span>&nbsp&#9745 Amount to be paid: $200.99</span>
            <button>Checkout</button>
        </div>

{% endblock %}

{% block scripts %}

<script>
    document.querySelectorAll(".quantity").forEach(qty => qty.addEventListener("change", changeSubtotal));
    total();

    // Change subtotal
    function changeSubtotal(element) {
        var price = this.previousElementSibling.innerHTML;
        var quantity = element.target.value; 
        var subtotal = parseFloat(price * quantity).toFixed(2);
        this.nextElementSibling.innerHTML = subtotal;
        total();
    }

    // Sum total
    function total(){
        var totalDisplay = document.getElementById("total_display");
        var totalQuantity = document.getElementById("total_quantity");
        var sum = 0;
        var noitems = 0;
        var tbody = document.getElementById("all_products");
        for (var i = 0; i < tbody.rows.length; i++) {
            sum = sum + parseFloat(tbody.rows[i].cells[3].innerHTML);
            noitems = noitems + parseFloat(tbody.rows[i].cells[2].getElementsByTagName('input')[0].value);
        }
        var total = sum.toFixed(2);
        var totalitems = noitems.toFixed(2);
        totalDisplay.innerHTML = "$ " + total;
        totalQuantity.innerHTML = totalitems;
    }
</script>

{% endblock %}